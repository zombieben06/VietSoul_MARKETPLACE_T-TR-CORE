<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VietSoul - Ch·ª£ VƒÉn H√≥a S·ªë</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Ch·ªâ gi·ªØ l·∫°i Playfair Display cho ti√™u ƒë·ªÅ v√† Inter cho n·ªôi dung -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* 1. KHAI B√ÅO FONT M·ªöI (SVN-Agency FB) */
        @font-face {
            font-family: 'SVN Agency FB';
            src: url('SVN-Agency FB.ttf') format('truetype'); /* S·ª≠ d·ª•ng file font ƒë√£ t·∫£i l√™n */
            font-weight: normal;
            font-style: normal;
        }
        body {
            font-family: 'Inter', sans-serif; /* D√πng Inter cho n·ªôi dung ch√≠nh d·ªÖ ƒë·ªçc */
            background-color: #fcf8f5; /* Light Peach/Beige - N·ªÅn nh·∫°t h∆°n (theo y√™u c·∫ßu tr∆∞·ªõc) */
            color: #333;
        }
        /* √Åp d·ª•ng Playfair Display cho t·∫•t c·∫£ c√°c ti√™u ƒë·ªÅ (font-heading) */
        h1, h2, h3, h4, .font-heading { 
            font-family: 'SVN Agency FB', serif;
        }
        
        /* ƒê·∫£m b·∫£o t·∫•t c·∫£ n·ªôi dung c√≤n l·∫°i l√† Inter */
        .text-xs, .text-sm, p, span, a, input, button {
            font-family: 'Inter', sans-serif;
        }
        /* Overwrite cho c√°c ph·∫ßn ti√™u ƒë·ªÅ l·ªõn ƒë·ªÉ ƒë·∫£m b·∫£o d√πng Playfair */
        .text-3xl, .text-2xl, .text-xl, .font-semibold, .font-bold {
             font-family: 'SVN Agency FB', serif;
        }
        
        .text-brand-primary { color: #920c0c; } /* Deep Red / Wine Red */
        .bg-brand-primary { background-color: #920c0c; }
        .text-brand-accent { color: #e1d6c0; } /* Earthy Beige - D√πng l√†m n·ªÅn cho c√°c th√†nh ph·∫ßn */
        .bg-brand-accent { background-color: #fcf8f5; } /* N·ªÅn nh·∫°t cho c√°c th√†nh ph·∫ßn */
        .bg-brand-light { background-color: #d7c093; } /* R·∫•t nh·∫°t, g·∫ßn tr·∫Øng */
        .shadow-custom { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        .product-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease, border 0.3s ease;
            border: 1px solid transparent;
        }
        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(146, 12, 12, 0.2);
            border: 2px solid #920c0c; /* Khung m√†u ƒë·ªè ƒë·∫≠m h∆°n khi hover */
        }
        .filter-btn {
            background-color: #fcf8f5; /* N·ªÅn nh·∫°t cho n√∫t filter th∆∞·ªùng */
            color: #5c0808; /* Text m√†u ƒë·ªè s·∫´m */
            transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
        }
        .filter-btn.active {
            background-color: #920c0c; /* M√†u ƒë·ªè brand cho active */
            color: white;
            box-shadow: 0 2px 8px rgba(146, 12, 12, 0.3);
        }
        .tab-btn {
            transition: border-bottom 0.3s, color 0.3s;
            font-family: 'Playfair Display', serif; /* D√πng Playfair cho tab */
        }
        .tab-btn.active {
            border-bottom: 3px solid #920c0c;
            color: #920c0c;
            font-weight: 700;
        }
        /* Chatbot Styles - Gi·ªØ Inter cho n·ªôi dung chat */
        .chat-bubble-user {
            background-color: #920c0c;
            color: white;
            border-bottom-right-radius: 0;
            max-width: 85%;
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 0.875rem;
            font-family: 'Inter', sans-serif;
        }
        .chat-bubble-ai {
            background-color: #fff;
            color: #5c0808;
            border: 1px solid #e2c68c;
            border-bottom-left-radius: 0;
            max-width: 90%;
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 0.875rem;
            animation: fadeIn 0.5s ease-out;
            font-family: 'Inter', sans-serif;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-brand-accent">

    <header class="sticky top-0 z-50 bg-white shadow-custom">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center max-w-7xl">
            <div class="flex items-center">
                <span class="text-3xl font-extrabold text-brand-primary font-heading">VietSoul</span>
                <span class="text-sm ml-2 px-2 py-1 rounded-full bg-brand-accent text-brand-primary font-semibold">CULTURE & GREEN COMMERCE</span>
            </div>
            <div class="flex items-center space-x-6">
                <input type="text" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m, l√†ng ngh·ªÅ..." class="hidden md:block w-72 border border-gray-300 rounded-full py-2 px-4 text-sm focus:ring-brand-primary focus:border-brand-primary">
                <button class="text-xl text-gray-700 hover:text-brand-primary transition duration-150" title="Gi·ªè h√†ng">üõí</button>
                <button class="text-xl text-gray-700 hover:text-brand-primary transition duration-150" title="T√†i kho·∫£n">üë§</button>
            </div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8 max-w-7xl grid grid-cols-1 md:grid-cols-12 gap-8">
        
        <aside class="md:col-span-3 bg-white p-6 rounded-xl shadow-custom h-fit sticky top-20">
            <h3 class="text-xl font-bold text-brand-primary mb-4 border-b pb-2 font-heading">Danh m·ª•c VƒÉn h√≥a</h3>
            <div id="filter-container" class="space-y-3">
                <button data-filter="all" class="filter-btn active w-full text-left py-2 px-4 rounded-lg transition duration-150 hover:bg-brand-accent">T·∫•t c·∫£ S·∫£n ph·∫©m</button>
                <button data-filter="tranh" class="filter-btn w-full text-left py-2 px-4 rounded-lg transition duration-150 hover:bg-brand-accent">Tranh D√¢n Gian</button>
                <button data-filter="gom" class="filter-btn w-full text-left py-2 px-4 rounded-lg transition duration-150 hover:bg-brand-accent">G·ªëm S·ª©</button>
                <button data-filter="lua" class="filter-btn w-full text-left py-2 px-4 rounded-lg transition duration-150 hover:bg-brand-accent">L·ª•a & V·∫£i Th·ªß c√¥ng</button>
                <button data-filter="dotuong" class="filter-btn w-full text-left py-2 px-4 rounded-lg transition duration-150 hover:bg-brand-accent">ƒê·ªì Th·ªù T∆∞·ª£ng</button>
                <button data-filter="gift" class="filter-btn w-full text-left py-2 px-4 rounded-lg transition duration-150 hover:bg-brand-accent">Qu√† t·∫∑ng ESG</button>
            </div>
            
            <h3 class="text-xl font-bold text-brand-primary mt-6 mb-4 border-b pb-2 font-heading">Ti√™u ch√≠ L·ªçc</h3>
            <label class="flex items-center space-x-2 text-sm text-gray-700 cursor-pointer hover:text-brand-primary transition duration-150">
                <input type="checkbox" id="green-tag-filter" class="rounded text-brand-primary focus:ring-brand-primary">
                <span>Ch·ªâ hi·ªÉn th·ªã "Green Tag"</span>
            </label>
        </aside>

        <section class="md:col-span-9">
            <h2 class="text-3xl font-bold text-brand-primary mb-6 font-heading">Marketplace: Tinh hoa Th·ªß c√¥ng Vi·ªát</h2>
            <p class="text-gray-700 mb-8">Kh√°m ph√° c√°c s·∫£n ph·∫©m ƒë·ªôc ƒë√°o t·ª´ l√†ng ngh·ªÅ, m·ªói m√≥n h√†ng ƒë·ªÅu ƒë∆∞·ª£c g·∫Øn C√¢u chuy·ªán Ngh·ªá nh√¢n v√† Ch·ª©ng nh·∫≠n Xanh.</p>
            
            <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            </div>
        </section>
    </main>
    
    <div id="detail-sidebar" class="fixed inset-y-0 right-0 w-full md:w-1/3 bg-white shadow-2xl z-50 transform translate-x-full transition-transform duration-300 overflow-y-auto p-6 flex flex-col">
        <div class="flex justify-between items-center border-b pb-4 mb-4">
            <h3 class="text-2xl font-bold text-brand-primary font-heading">Chi ti·∫øt S·∫£n ph·∫©m</h3>
            <button id="close-sidebar-btn" class="text-2xl text-gray-500 hover:text-red-500 transition duration-150">‚ùå</button>
        </div>
        
        <div class="flex-grow">
            <div id="product-summary" class="mb-6">
                <!-- Product summary will be rendered here --></div>

            <div class="border-t pt-4">
                <div class="flex space-x-2 border-b">
                    <button class="tab-btn active px-4 py-2 text-brand-primary font-heading" data-tab-content="story">Chuy·ªán Ngh·ªÅ & AI Storytelling</button>
                    <button class="tab-btn px-4 py-2 text-brand-primary font-heading" data-tab-content="green-tag">D·∫•u Hi·ªáu Xanh (Green Tag)</button>
                </div>
                
                <div id="story-content" class="tab-content pt-4">
                    <h4 class="font-semibold text-xl text-brand-primary mb-3 font-heading">AI K·ªÉ Chuy·ªán Ngh·ªá Nh√¢n:</h4>
                    
                    <div id="chat-interface" class="bg-brand-accent h-80 rounded-lg p-3 flex flex-col shadow-inner">
                        <div id="product-chat-window" class="flex-grow overflow-y-auto space-y-3 pr-2">
                            <!-- Chat messages will be appended here --></div>
                        <div class="mt-3 flex">
                            <input type="text" id="product-chat-input" placeholder="H·ªèi AI v·ªÅ l·ªãch s·ª≠ ho·∫∑c ngh·ªá nh√¢n..." class="flex-grow border border-gray-300 rounded-full py-2 px-4 text-sm focus:ring-brand-primary focus:border-brand-primary" disabled>
                            <button id="product-send-btn" class="ml-2 bg-brand-primary text-white p-2 rounded-full w-9 h-9 flex items-center justify-center hover:bg-red-900 disabled:opacity-50" title="G·ª≠i c√¢u h·ªèi" disabled>
                                <span class="text-lg">‚Üë</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="green-tag-content" class="tab-content hidden pt-4">
                    <h4 class="font-semibold text-xl text-brand-primary mb-3 font-heading">Cam k·∫øt B·ªÅn v·ªØng (Green Tag Checklist):</h4>
                    <ul id="green-tag-list" class="space-y-2 text-gray-700">
                        <!-- Green tags will be rendered here --></ul>
                </div>
            </div>
        </div>
        
        <button class="w-full bg-brand-primary text-white font-bold py-3 rounded-full hover:bg-red-900 transition duration-300 mt-6 shadow-xl shadow-red-200 font-heading">
            Th√™m v√†o Gi·ªè h√†ng
        </button>
    </div>

    <script>
        // Placeholder for user turn in script
        const USER_TURN = 'user_turn';

        // Mocked response data, keyed by product ID
        const mockChatResponses = {
            1: [ // Tranh Ng≈© H·ªï L√†ng S√¨nh
                { role: 'ai', text: 'Ch√†o b·∫°n, t√¥i l√† AI H∆∞·ªõng D·∫´n c·ªßa VietSoul. T√¥i c√≥ th·ªÉ k·ªÉ cho b·∫°n nghe v·ªÅ l·ªãch s·ª≠ Tranh Ng≈© H·ªï, √Ω nghƒ©a t·ª´ng chi ti·∫øt, ho·∫∑c ng∆∞·ªùi ngh·ªá nh√¢n t·∫°o ra n√≥. B·∫°n mu·ªën bi·∫øt g√¨?' },
                { role: USER_TURN, text: 'K·ªÉ cho t√¥i v·ªÅ ng∆∞·ªùi ngh·ªá nh√¢n ƒëi.' },
                { role: 'ai', text: 'Tuy·ªát v·ªùi! Ng∆∞·ªùi ngh·ªá nh√¢n l√† B, ng∆∞·ªùi ƒë√£ b·∫£o t·ªìn b√≠ quy·∫øt kh·∫Øc v√† in tranh S√¨nh qua 5 th·∫ø h·ªá trong gia ƒë√¨nh. √îng tin r·∫±ng m·ªói n√©t ch·∫°m l√† m·ªôt l·ªùi c·∫ßu nguy·ªán. D√π ƒë√£ 80 tu·ªïi, √¥ng v·∫´n tr·ª±c ti·∫øp gi√°m s√°t vi·ªác ch·∫ø t√°c b·∫£n in ƒë·ªÉ ƒë·∫£m b·∫£o ƒë·ªô tinh x·∫£o.' }
            ],
            2: [ // B√¨nh G·ªëm Hoa Sen Kh·∫£m
                { role: 'ai', text: 'Ch√†o b·∫°n, chi·∫øc b√¨nh g·ªëm n√†y ƒë·∫øn t·ª´ B√°t Tr√†ng, nh∆∞ng v·ªõi c√¥ng th·ª©c nung ƒë·∫∑c bi·ªát ƒë·ªÉ gi·∫£m thi·ªÉu carbon. B·∫°n mu·ªën t√¨m hi·ªÉu v·ªÅ quy tr√¨nh nung xanh hay √Ω nghƒ©a c·ªßa h·ªça ti·∫øt Hoa Sen?' },
                { role: USER_TURN, text: 'Quy tr√¨nh nung xanh l√† g√¨?' },
                { role: 'ai', text: 'Quy tr√¨nh Nung Xanh gi·∫£m nhi·ªát ƒë·ªô nung g·ªëm xu·ªëng 100 ƒë·ªô C so v·ªõi truy·ªÅn th·ªëng. ƒêi·ªÅu n√†y gi√∫p ti·∫øt ki·ªám 15% nƒÉng l∆∞·ª£ng v√† gi·∫£m ƒë√°ng k·ªÉ kh√≠ th·∫£i CO2. M·∫∑c d√π t·ªën nhi·ªÅu c√¥ng s·ª©c h∆°n, h·ª£p t√°c x√£ cam k·∫øt th·ª±c hi·ªán v√¨ tr√°ch nhi·ªám m√¥i tr∆∞·ªùng.' }
            ],
            3: [ // KhƒÉn L·ª•a V·∫°n Ph√∫c Nhu·ªôm Ch√†m
                { role: 'ai', text: 'Ch√†o b·∫°n, ƒë√¢y l√† s·∫£n ph·∫©m l·ª•a V·∫°n Ph√∫c nhu·ªôm b·∫±ng ph∆∞∆°ng ph√°p truy·ªÅn th·ªëng. B·∫°n c√≥ mu·ªën bi·∫øt v·ªÅ quy tr√¨nh nhu·ªôm Ch√†m hay c√¢u chuy·ªán kh·ªüi nghi·ªáp c·ªßa ng∆∞·ªùi ngh·ªá nh√¢n tr·∫ª?' },
                { role: 'user_turn', text: 'K·ªÉ v·ªÅ c√¢u chuy·ªán kh·ªüi nghi·ªáp.' },
                { role: 'ai', text: 'Th∆∞∆°ng hi·ªáu S·∫Øc Vi·ªát ƒë∆∞·ª£c th√†nh l·∫≠p b·ªüi m·ªôt ng∆∞·ªùi con c·ªßa l√†ng V·∫°n Ph√∫c, v·ªõi mong mu·ªën ƒë∆∞a k·ªπ thu·∫≠t nhu·ªôm Ch√†m kh√¥ng h√≥a ch·∫•t l√™n n·ªÅn t·∫£ng s·ªë. H·ªç ƒë√£ ·ª©ng d·ª•ng c√¥ng ngh·ªá ƒë·ªÉ t√¨m ki·∫øm kh√°ch h√†ng qu·ªëc t·∫ø, nh∆∞ng v·∫´n gi·ªØ nguy√™n s·ª± t·ªâ m·ªâ th·ªß c√¥ng trong t·ª´ng s·∫£n ph·∫©m.' }
            ],
            4: [ // B·ªô Qu√† t·∫∑ng VƒÉn h√≥a 'H·ªìn Vi·ªát'
                { role: 'ai', text: 'Xin ch√†o, ƒë√¢y l√† B·ªô Qu√† T·∫∑ng ESG d√†nh ri√™ng cho doanh nghi·ªáp. Ch√∫ng t√¥i c√≥ th·ªÉ cung c·∫•p b√°o c√°o t√°c ƒë·ªông x√£ h·ªôi (Social Impact Report) ƒëi k√®m v·ªõi b·ªô qu√†. B·∫°n mu·ªën xem b√°o c√°o hay y√™u c·∫ßu t√πy ch·ªânh (customization)?' },
                { role: 'user_turn', text: 'Y√™u c·∫ßu t√πy ch·ªânh.' },
                { role: 'ai', text: 'Tuy·ªát v·ªùi! Ch√∫ng t√¥i c√≥ th·ªÉ in logo doanh nghi·ªáp b·∫°n b·∫±ng m·ª±c sinh h·ªçc l√™n bao b√¨ t√°i ch·∫ø, ho·∫∑c t√πy ch·ªânh c√°c s·∫£n ph·∫©m th·ªß c√¥ng b√™n trong theo ch·ªß ƒë·ªÅ c·ªßa s·ª± ki·ªán.' }
            ],
            5: [ // ƒê·ªì trang tr√≠ m√¢y tre ƒëan
                { role: 'ai', text: 'Ch√†o b·∫°n, s·∫£n ph·∫©m m√¢y tre ƒëan n√†y ƒë·∫øn t·ª´ H·ª£p t√°c x√£ Bao La. B·∫°n mu·ªën bi·∫øt v·ªÅ k·ªπ thu·∫≠t ƒëan th·ªß c√¥ng hay ngu·ªìn g·ªëc v·∫≠t li·ªáu t·ª± nhi√™n c·ªßa s·∫£n ph·∫©m?' },
                { role: 'user_turn', text: 'Ngu·ªìn g·ªëc v·∫≠t li·ªáu t·ª± nhi√™n.' },
                { role: 'ai', text: 'Nguy√™n li·ªáu m√¢y tre ƒë∆∞·ª£c thu ho·∫°ch b·ªÅn v·ªØng, ph∆°i n·∫Øng t·ª± nhi√™n thay v√¨ t·∫©y tr·∫Øng b·∫±ng h√≥a ch·∫•t. D√π kh√¥ng c√≥ Green Tag ch√≠nh th·ª©c, s·∫£n ph·∫©m cam k·∫øt quy tr√¨nh ch·∫ø t√°c s·∫°ch v√† th√¢n thi·ªán v·ªõi m√¥i tr∆∞·ªùng.' }
            ],
             6: [ // T∆∞·ª£ng g·ªó Quan √Çm L√†ng ƒê·ªìng K·ªµ
                { role: 'ai', text: 'Ch√†o b·∫°n, ƒë√¢y l√† b·ª©c T∆∞·ª£ng Quan √Çm ƒë∆∞·ª£c ch·∫°m kh·∫Øc t·∫°i l√†ng ƒê·ªìng K·ªµ. T√°c ph·∫©m n√†y ƒë∆∞·ª£c l√†m t·ª´ g·ªó t√°i ch·∫ø (g·ªó c≈© ƒë∆∞·ª£c khai th√°c b·ªÅn v·ªØng). B·∫°n mu·ªën bi·∫øt v·ªÅ ngu·ªìn g·ªëc g·ªó, √Ω nghƒ©a phong th·ªßy, hay quy tr√¨nh ch·∫°m kh·∫Øc th·ªß c√¥ng?' },
                { role: 'user_turn', text: 'Quy tr√¨nh ch·∫°m kh·∫Øc th·ªß c√¥ng.' },
                { role: 'ai', text: 'Ngh·ªá nh√¢n T c√≥ k·ªπ thu·∫≠t ch·∫°m kh·∫Øc n·ªïi b·∫≠t, k·∫øt h·ª£p c√°c n√©t truy·ªÅn th·ªëng v√† hi·ªán ƒë·∫°i, gi√∫p ti·∫øt ki·ªám nguy√™n li·ªáu g·ªó m√† v·∫´n ƒë·∫£m b·∫£o ƒë·ªô tinh x·∫£o. T√°c ph·∫©m n√†y l√† s·ª± t√¥n vinh s·ª± t·ªâ m·ªâ, c√¥ng s·ª©c v√† ki√™n nh·∫´n c·ªßa ngh·ªá nh√¢n.' }
            ],
             7: [ // Tranh s∆°n m√†i 'Ph·ªë c·ªï H√† N·ªôi'
                { role: 'ai', text: 'Xin ch√†o, ƒë√¢y l√† s·∫£n ph·∫©m tranh s∆°n m√†i cao c·∫•p, s·ª≠ d·ª•ng k·ªπ thu·∫≠t m√†i truy·ªÅn th·ªëng k·∫øt h·ª£p v·∫≠t li·ªáu t·ª± nhi√™n. B·∫°n mu·ªën t√¨m hi·ªÉu v·ªÅ v·∫≠t li·ªáu s∆°n m√†i (nh·ª±a c√¢y s∆°n) hay h·ªça sƒ© ƒë√£ s√°ng t√°c t√°c ph·∫©m n√†y?' },
                { role: 'user_turn', text: 'V·∫≠t li·ªáu s∆°n m√†i.' },
                { role: 'ai', text: 'S∆°n m√†i truy·ªÅn th·ªëng ƒë√≤i h·ªèi ƒë·ªô kh√©o l√©o cao. L·ªõp s∆°n ·ªü ƒë√¢y ƒë∆∞·ª£c khai th√°c t·ª´ c√¢y s∆°n (c√¢y Rhus verniciflua) v√† ƒë∆∞·ª£c l·ªçc k·ªπ l∆∞·ª°ng, ƒë·∫£m b·∫£o ƒë·ªô b√≥ng t·ª± nhi√™n m√† kh√¥ng c·∫ßn h√≥a ch·∫•t c√¥ng nghi·ªáp. Tuy nhi√™n, do qu√° tr√¨nh ch·∫ø t√°c m·∫•t nhi·ªÅu th·ªùi gian, gi√° th√†nh cao h∆°n.' }
            ],
             8: [ // T√∫i v·∫£i ESG th√™u tay
                { role: 'ai', text: 'Ch√†o b·∫°n, ƒë√¢y l√† m·ªôt s·∫£n ph·∫©m ph·ª• ki·ªán th·ªùi trang v·ªõi m·ª•c ti√™u x√£ h·ªôi (Social-impact). B·∫°n mu·ªën bi·∫øt v·ªÅ ngu·ªìn g·ªëc v·∫£i t√°i ch·∫ø, hay ch∆∞∆°ng tr√¨nh t·∫°o vi·ªác l√†m cho ng∆∞·ªùi khuy·∫øt t·∫≠t th√¥ng qua vi·ªác th√™u tay?' },
                { role: 'user_turn', text: 'Ch∆∞∆°ng tr√¨nh t·∫°o vi·ªác l√†m.' },
                { role: 'ai', text: 'T√∫i v·∫£i n√†y l√† k·∫øt qu·∫£ c·ªßa h·ª£p t√°c x√£ X, n∆°i 100% ng∆∞·ªùi th√™u l√† ng∆∞·ªùi khuy·∫øt t·∫≠t. C√¥ng vi·ªác th√™u tay kh√¥ng ch·ªâ t·∫°o thu nh·∫≠p ·ªïn ƒë·ªãnh m√† c√≤n gi√∫p h·ªç t√°i h√≤a nh·∫≠p x√£ h·ªôi, mang l·∫°i √Ω nghƒ©a s√¢u s·∫Øc cho s·∫£n ph·∫©m n√†y.' }
            ]
        };

        // Global chat state variables
        let currentProductChatId = null;
        let chatHistory = {};

        function addMessage(chatWindow, role, text) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex', 'space-x-3', 'mb-3');
            
            if (role === 'user') {
                messageDiv.classList.add('justify-end');
                messageDiv.innerHTML = `<div class="p-2 chat-bubble-user rounded-xl shadow-md">${text}</div>`;
            } else {
                messageDiv.classList.add('justify-start', 'items-start');
                messageDiv.innerHTML = `
                    <span class="text-xl text-brand-primary">ü§ñ</span>
                    <div class="p-2 chat-bubble-ai rounded-xl shadow-md flex flex-col">
                        <p class="font-bold mb-1 text-xs text-brand-primary font-heading">VietSoul AI Guide</p>
                        <p>${text}</p>
                    </div>
                `;
            }
            
            chatWindow.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function startChatSimulation(productId) {
            const chatWindow = document.getElementById('product-chat-window');
            const input = document.getElementById('product-chat-input');
            const sendBtn = document.getElementById('product-send-btn');
            
            const currentStep = chatHistory[productId] || 0;
            const data = mockChatResponses[productId];

            if (data && currentStep < data.length) {
                const message = data[currentStep];
                
                if (message.role === 'ai') {
                    addMessage(chatWindow, 'ai', message.text);
                    chatHistory[productId]++;
                    input.disabled = true;
                    sendBtn.disabled = true;

                    // Schedule the next message or enable user input
                    if (chatHistory[productId] < data.length) {
                        const nextMessage = data[chatHistory[productId]];
                        if (nextMessage.role === 'ai') {
                            setTimeout(() => startChatSimulation(productId), 3000); // AI to AI
                        } else if (nextMessage.role === USER_TURN) {
                            setTimeout(() => {
                                input.disabled = false;
                                sendBtn.disabled = false;
                                input.placeholder = "G√µ c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n...";
                                input.focus();
                            }, 1000);
                        }
                    } else {
                        // End of script
                        setTimeout(() => {
                             input.placeholder = "B·∫°n ƒë√£ kh√°m ph√° h·∫øt c√¢u chuy·ªán n√†y. Th√™m v√†o gi·ªè h√†ng nh√©!";
                             input.disabled = true;
                             sendBtn.disabled = true;
                             addMessage(chatWindow, 'ai', "C·∫£m ∆°n b·∫°n ƒë√£ kh√°m ph√°! C√¢u chuy·ªán ƒë√£ k·∫øt th√∫c, b·∫°n c√≥ th·ªÉ tham kh·∫£o tab Green Tag ho·∫∑c ti·∫øp t·ª•c mua h√†ng.");
                        }, 1000);
                    }

                } else if (message.role === USER_TURN) {
                    // This case is only hit if the user re-enters the tab and it's their turn
                    input.disabled = false;
                    sendBtn.disabled = false;
                    input.placeholder = "G√µ c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n...";
                    input.focus();
                }
            } else if (data && currentStep >= data.length) {
                 input.placeholder = "B·∫°n ƒë√£ kh√°m ph√° h·∫øt c√¢u chuy·ªán n√†y. Th√™m v√†o gi·ªè h√†ng nh√©!";
                 input.disabled = true;
                 sendBtn.disabled = true;
            }
        }

        function handleChatInput(e) {
            const input = document.getElementById('product-chat-input');
            const sendBtn = document.getElementById('product-send-btn');
            const chatWindow = document.getElementById('product-chat-window');
            const inputText = input.value.trim();
            
            if ((e.type === 'click' || (e.type === 'keypress' && e.key === 'Enter')) && inputText && !input.disabled) {
                const productId = currentProductChatId;
                const currentStep = chatHistory[productId];
                const data = mockChatResponses[productId];
                
                // 1. Display user message
                addMessage(chatWindow, 'user', inputText);
                input.value = '';
                
                // 2. Advance chat step
                input.disabled = true;
                sendBtn.disabled = true;
                
                if (data && currentStep < data.length && data[currentStep].role === USER_TURN) {
                    // Match found: advance the script step
                    chatHistory[productId]++; 
                } else if (currentStep === 0) {
                     // First message, always advance to start AI script
                    chatHistory[productId]++;
                } 
                
                // 3. Trigger next AI response after a short delay
                setTimeout(() => startChatSimulation(productId), 1500); 

            }
        }


        document.addEventListener('DOMContentLoaded', () => {
            
            /* ===== 1. MOCK DATA & STATE (Repeated for local reference) ===== */
            const products = [
                { id: 1, name: "Tranh Ng≈© H·ªï L√†ng S√¨nh", price: "450.000 VNƒê", artist: "Ngh·ªá nh√¢n Nguy·ªÖn VƒÉn B", category: "tranh", location: "Hu·∫ø",
                  img: "https://file.hstatic.net/200000017614/file/tranh-ngu-ho-1_430d9f1800314e81b3e2fb3a27f5c9a6.jpg", // H√¨nh ·∫£nh Tranh Ng≈© H·ªï
                  story: "Tranh Ng≈© H·ªï l√† bi·ªÉu t∆∞·ª£ng h·ªô m·ªánh c·ªßa ng∆∞·ªùi d√¢n Hu·∫ø. B·ª©c tranh n√†y ƒë∆∞·ª£c kh·∫Øc t·ª´ khu√¥n g·ªó h∆°n 100 nƒÉm tu·ªïi, in b·∫±ng tay v·ªõi m·ª±c sinh h·ªçc. C√¢u chuy·ªán v·ªÅ ng∆∞·ªùi th·ª£ B ƒë√£ gi·ªØ g√¨n b√≠ quy·∫øt n√†y qua 5 th·∫ø h·ªá l√† minh ch·ª©ng cho s·ª± ki√™n tr√¨ v·ªõi di s·∫£n vƒÉn h√≥a phi v·∫≠t th·ªÉ.",
                  greenTags: ["Bao b√¨ t√°i ch·∫ø (Kraft)", "M·ª±c in sinh h·ªçc", "Giao h√†ng Carbon th·∫•p (Eco-Delivery)"],
                  isGreen: true
                },
                { id: 2, name: "B√¨nh G·ªëm Hoa Sen Kh·∫£m", price: "890.000 VNƒê", artist: "H·ª£p t√°c x√£ B√°t Tr√†ng", category: "g·ªëm", location: "H√† N·ªôi",
                  img: "https://i.etsystatic.com/20886807/r/il/15690c/1977818224/il_1080xN.1977818224_mo5c.jpg", // H√¨nh ·∫£nh B√¨nh G·ªëm Hoa Sen Kh·∫£m
                  story: "B√¨nh g·ªëm n√†y ƒë∆∞·ª£c nung ·ªü nhi·ªát ƒë·ªô th·∫•p h∆°n ti√™u chu·∫©n c√¥ng nghi·ªáp ƒë·ªÉ gi·∫£m ph√°t th·∫£i kh√≠ CO2, nh∆∞ng v·∫´n gi·ªØ ƒë∆∞·ª£c ƒë·ªô b·ªÅn. H·ªça ti·∫øt Hoa Sen t∆∞·ª£ng tr∆∞ng cho s·ª± thanh khi·∫øt, ƒë∆∞·ª£c kh·∫£m th·ªß c√¥ng t·ªâ m·ªâ trong 3 ng√†y.",
                  greenTags: ["S·∫£n xu·∫•t ti·∫øt ki·ªám nƒÉng l∆∞·ª£ng", "Nguy√™n li·ªáu ƒë·∫•t s√©t t·ª± nhi√™n", "Kh√¥ng s·ª≠ d·ª•ng ch√¨/h√≥a ch·∫•t ƒë·ªôc h·∫°i"],
                  isGreen: true
                },
                { id: 3, name: "KhƒÉn L·ª•a V·∫°n Ph√∫c Nhu·ªôm Ch√†m", price: "280.000 VNƒê", artist: "Th∆∞∆°ng hi·ªáu S·∫Øc Vi·ªát", category: "l·ª•a", location: "H√† N·ªôi",
                  img: "https://cdn.shopify.com/s/files/1/0101/0450/4401/products/c4-jpg-1575540676767_600x.jpg?v=1575622995", // H√¨nh ·∫£nh KhƒÉn L·ª•a V·∫°n Ph√∫c Nhu·ªôm Ch√†m
                  story: "S·∫£n ph·∫©m s·ª≠ d·ª•ng ph∆∞∆°ng ph√°p nhu·ªôm Ch√†m truy·ªÅn th·ªëng, kh√¥ng th·∫£i h√≥a ch·∫•t ra m√¥i tr∆∞·ªùng. KhƒÉn l·ª•a m·ªÅm m·∫°i, gi·ªØ ·∫•m t·ªët, l√† m√≥n qu√† l√Ω t∆∞·ªüng cho ng∆∞·ªùi th√¢n y√™u. C√¢u chuy·ªán v·ªÅ ng∆∞·ªùi ph·ª• n·ªØ kh·ªüi nghi·ªáp ·ªü l√†ng l·ª•a V·∫°n Ph√∫c trong th·ªùi ƒë·∫°i s·ªë.",
                  greenTags: ["Nhu·ªôm t·ª± nhi√™n (Ch√†m)", "V·∫≠t li·ªáu v·∫£i l·ª•a t∆° t·∫±m", "Bao b√¨ gi·∫•y t√°i ch·∫ø"],
                  isGreen: true
                },
                { id: 4, name: "B·ªô Qu√† t·∫∑ng VƒÉn h√≥a 'H·ªìn Vi·ªát'", price: "1.250.000 VNƒê", artist: "VietSoul Originals", category: "gift", location: "ƒêa d·∫°ng",
                  img: "https://file.hstatic.net/200000290629/article/0dfe42b7-2dda-4150-a01a-2a6d5315e6d5_ec514eccc14143e2bea9ac86d0f7fad3_fb6e16db861c4c208ed744fa6fee83fa.jpeg", // H√¨nh ·∫£nh B·ªô Qu√† t·∫∑ng VƒÉn h√≥a 'H·ªìn Vi·ªát'
                  story: "B·ªô qu√† t·∫∑ng ƒë∆∞·ª£c thi·∫øt k·∫ø d√†nh ri√™ng cho doanh nghi·ªáp (B2B) nh·∫±m m·ª•c ƒë√≠ch ESG. Bao g·ªìm m·ªôt m√≥n g·ªëm mini, m·ªôt cu·ªën s·ªï tay t·ª´ gi·∫•y t√°i ch·∫ø v√† m·ªôt postcard Tranh S√¨nh. M·ªói h·ªôp qu√† l√† m·ªôt th√¥ng ƒëi·ªáp v·ªÅ tr√°ch nhi·ªám x√£ h·ªôi.",
                  greenTags: ["100% v·∫≠t li·ªáu t√°i ch·∫ø", "S·∫£n ph·∫©m ƒë∆∞·ª£c ch·ª©ng nh·∫≠n Green Tag", "T·∫°o sinh k·∫ø cho 3 l√†ng ngh·ªÅ"],
                  isGreen: true
                },
                { id: 5, name: "ƒê·ªì trang tr√≠ m√¢y tre ƒëan", price: "150.000 VNƒê", artist: "H·ª£p t√°c x√£ Bao La", category: "g·ªëm", location: "Hu·∫ø",
                  img: "https://dantra.vn/uploads/san-pham/thi-cong/decor-tuong/trang-tri-may-tre-dan-16.jpg", // H√¨nh ·∫£nh ƒê·ªì trang tr√≠ m√¢y tre ƒëan
                  story: "M√≥n ƒë·ªì trang tr√≠ nh√† c·ª≠a, s·ª≠ d·ª•ng nguy√™n li·ªáu m√¢y tre ƒëan t·ª± nhi√™n, ph∆°i n·∫Øng ƒë·ªÉ t·∫°o m√†u, kh√¥ng d√πng thu·ªëc nhu·ªôm c√¥ng nghi·ªáp. S·∫£n ph·∫©m n√†y kh√¥ng c√≥ Green Tag v√¨ v·∫≠n chuy·ªÉn xa, nh∆∞ng ngh·ªá nh√¢n cam k·∫øt v·ªÅ nguy√™n li·ªáu.",
                  greenTags: ["Nguy√™n li·ªáu m√¢y tre t·ª± nhi√™n"],
                  isGreen: false
                },
                // Th√™m 3 s·∫£n ph·∫©m m·ªõi
                { id: 6, name: "T∆∞·ª£ng Quan √Çm G·ªó T√°i ch·∫ø", price: "2.500.000 VNƒê", artist: "Ngh·ªá nh√¢n T, L√†ng ƒê·ªìng K·ªµ", category: "g·ªó", location: "B·∫Øc Ninh",
                  img: "https://godinh.com/web/image/1714964/image3.png?access_token=b5472d81-b8e6-48c6-925f-d499eb9f49ed", // H√¨nh ·∫£nh T∆∞·ª£ng Quan √Çm G·ªó T√°i ch·∫ø
                  story: "B·ª©c t∆∞·ª£ng n√†y ƒë∆∞·ª£c l√†m t·ª´ g·ªó t√°i ch·∫ø t·ª´ c√°c c√¥ng tr√¨nh c≈©, ƒë·∫£m b·∫£o t√≠nh b·ªÅn v·ªØng v√† gi·∫£m thi·ªÉu khai th√°c r·ª´ng. Ngh·ªá nh√¢n T ƒë√£ th·ªïi h·ªìn v√†o t√°c ph·∫©m, truy·ªÅn t·∫£i s·ª± t·ª´ bi, thanh t·ªãnh.",
                  greenTags: ["S·ª≠ d·ª•ng g·ªó t√°i ch·∫ø", "C√¥ng ƒëo·∫°n ch·∫°m kh·∫Øc gi·∫£m thi·ªÉu ph·∫ø li·ªáu", "Kh√¥ng d√πng h√≥a ch·∫•t b·∫£o qu·∫£n"],
                  isGreen: true
                },
                { id: 7, name: "Tranh S∆°n M√†i 'Ph·ªë C·ªï'", price: "3.800.000 VNƒê", artist: "H·ªça sƒ© V", category: "tranh", location: "H√† N·ªôi",
                  img: "https://www.kiettacnghethuat.com/wp-content/uploads/ha-noi-moi-tranh-son-mai-pho-cua-hoa-si-nguyen-van-nghia.jpg", // H√¨nh ·∫£nh Tranh S∆°n M√†i 'Ph·ªë C·ªï'
                  story: "Tranh s∆°n m√†i v·∫Ω phong c·∫£nh Ph·ªë C·ªï, s·ª≠ d·ª•ng nh·ª±a c√¢y s∆°n t·ª± nhi√™n. Quy tr√¨nh ch·∫ø t√°c m·∫•t 6 th√°ng v·ªõi nhi·ªÅu c√¥ng ƒëo·∫°n m√†i v√† ƒë√°nh b√≥ng th·ªß c√¥ng. ƒê√¢y l√† m·ªôt t√°c ph·∫©m ngh·ªá thu·∫≠t c√≥ gi√° tr·ªã ƒë·∫ßu t∆∞ v√† b·ªÅn v·ªØng v·ªÅ m·∫∑t v·∫≠t li·ªáu.",
                  greenTags: ["Nguy√™n li·ªáu nh·ª±a c√¢y s∆°n t·ª± nhi√™n", "Gi·∫£m thi·ªÉu h√≥a ch·∫•t", "ƒê·ªô b·ªÅn tr√™n 50 nƒÉm"],
                  isGreen: true
                },
                { id: 8, name: "T√∫i V·∫£i Th√™u Tay 'Sen'", price: "350.000 VNƒê", artist: "H·ª£p t√°c x√£ X√£ h·ªôi X", category: "l·ª•a", location: "TP.HCM",
                  img: "https://i.etsystatic.com/32617721/r/il/e9c3b6/3697004149/il_1588xN.3697004149_jjyv.jpg", // H√¨nh ·∫£nh T√∫i V·∫£i Th√™u Tay 'Sen'
                  story: "T√∫i Tote v·∫£i ƒë∆∞·ª£c may t·ª´ v·∫£i b√¥ng t√°i ch·∫ø (Recycled Cotton), th√¢n thi·ªán m√¥i tr∆∞·ªùng. H·ªça ti·∫øt hoa sen th√™u tay b·ªüi ng∆∞·ªùi khuy·∫øt t·∫≠t, mang th√¥ng ƒëi·ªáp v·ªÅ s·ª± ki√™n c∆∞·ªùng v√† h·ªó tr·ª£ c·ªông ƒë·ªìng.",
                  greenTags: ["V·∫£i b√¥ng t√°i ch·∫ø 100%", "T·∫°o sinh k·∫ø cho ng∆∞·ªùi khuy·∫øt t·∫≠t", "Kh√¥ng ch·∫•t t·∫©y tr·∫Øng"],
                  isGreen: true
                }
            ];

            let currentFilter = 'all';
            let greenTagOnly = false;
            
            /* ===== 2. DOM Elements & HANDLERS ===== */
            const productGrid = document.getElementById('product-grid');
            const filterButtons = document.querySelectorAll('#filter-container .filter-btn');
            const detailSidebar = document.getElementById('detail-sidebar');
            const closeSidebarBtn = document.getElementById('close-sidebar-btn');
            const greenTagFilterCheckbox = document.getElementById('green-tag-filter');
            
            const productSummary = document.getElementById('product-summary');
            const greenTagList = document.getElementById('green-tag-list');

            const tabButtons = document.querySelectorAll('#detail-sidebar .tab-btn');
            const tabContents = document.querySelectorAll('#detail-sidebar .tab-content');

            const inputElement = document.getElementById('product-chat-input');
            const sendButton = document.getElementById('product-send-btn');
            
            // Attach event listeners for chat input
            sendButton.addEventListener('click', handleChatInput);
            inputElement.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleChatInput(e);
                }
            });

            /* ===== 3. FUNCTIONS (Shared functions defined globally above) ===== */

            function renderProducts(categoryFilter, isGreenOnly) {
                productGrid.innerHTML = '';
                
                const filteredProducts = products.filter(p => {
                    const categoryMatch = categoryFilter === 'all' || p.category === categoryFilter;
                    const greenMatch = !isGreenOnly || p.isGreen;
                    return categoryMatch && greenMatch;
                });

                if (filteredProducts.length === 0) {
                    productGrid.innerHTML = `<p class="text-gray-500 col-span-full italic p-8 text-center bg-white rounded-xl shadow-custom">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o ph√π h·ª£p v·ªõi ti√™u ch√≠ l·ªçc.</p>`;
                    return;
                }

                filteredProducts.forEach(product => {
                    const card = document.createElement('div');
                    card.classList.add('product-card', 'bg-white', 'rounded-xl', 'overflow-hidden', 'shadow-custom', 'cursor-pointer', 'transition', 'duration-300');
                    card.setAttribute('data-id', product.id);
                    
                    const greenTagIcon = product.isGreen ? 
                        `<span class="text-xs font-bold text-white bg-brand-primary px-2 py-0.5 rounded-full absolute top-3 right-3 shadow-md">üåø Green Tag</span>` : 
                        `<span class="text-xs font-bold text-gray-700 bg-gray-200 px-2 py-0.5 rounded-full absolute top-3 right-3">Th·ªß c√¥ng</span>`;

                    card.innerHTML = `
                        <div class="relative">
                            <img src="${product.img}" alt="${product.name}" class="w-full h-48 object-cover">
                            ${greenTagIcon}
                        </div>
                        <div class="p-4">
                            <p class="text-xs text-gray-500 mb-1">${product.location} | ${product.category.toUpperCase()}</p>
                            <h4 class="font-semibold text-lg text-brand-primary font-heading truncate" title="${product.name}">${product.name}</h4>
                            <p class="text-gray-800 font-bold mt-2">${product.price}</p>
                            <p class="text-sm text-gray-600 mt-1">Ngh·ªá nh√¢n: ${product.artist}</p>
                        </div>
                    `;
                    productGrid.appendChild(card);
                });

                // Attach event listeners to newly rendered cards
                productGrid.querySelectorAll('.product-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const productId = parseInt(card.getAttribute('data-id'));
                        showProductDetail(productId);
                    });
                });
            }

            function showProductDetail(id) {
                const product = products.find(p => p.id === id);
                if (!product) return;
                
                // 1. Update Product Summary
                productSummary.innerHTML = `
                    <img src="${product.img}" alt="${product.name}" class="w-full h-32 object-cover rounded-lg mb-4">
                    <h4 class="text-xl font-bold text-brand-primary font-heading">${product.name}</h4>
                    <p class="text-lg font-bold text-gray-800">${product.price}</p>
                    <p class="text-sm text-gray-500 mt-1">Ngh·ªá nh√¢n: ${product.artist} | ${product.location}</p>
                `;

                // 2. Update Green Tag Tab
                greenTagList.innerHTML = product.greenTags.map(tag => 
                    `<li class="flex items-start space-x-2">
                        <span class="text-xl text-brand-primary">‚úÖ</span>
                        <p>${tag}</p>
                    </li>`
                ).join('');
                if (product.greenTags.length === 0) {
                     greenTagList.innerHTML = `<li class="text-gray-500 italic">S·∫£n ph·∫©m n√†y cam k·∫øt th·ªß c√¥ng nh∆∞ng ch∆∞a c√≥ ch·ª©ng nh·∫≠n Green Tag ch√≠nh th·ª©c.</li>`;
                }

                // 3. Initialize Chat Interface
                const chatWindow = document.getElementById('product-chat-window');
                chatWindow.innerHTML = ''; // Clear previous chat
                currentProductChatId = id;
                
                // Reset chat history for the product to restart the storytelling
                chatHistory[id] = 0;

                // Start the chat simulation when the detail sidebar is shown
                // Use a short delay to allow sidebar transition to finish
                setTimeout(() => startChatSimulation(id), 500); 

                // Reset tabs to default (Storytelling)
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.add('hidden'));
                document.querySelector('[data-tab-content="story"]').classList.add('active');
                document.getElementById('story-content').classList.remove('hidden');

                // Show Sidebar
                detailSidebar.classList.remove('translate-x-full');
            }
            
            function hideProductDetail() {
                detailSidebar.classList.add('translate-x-full');
                currentProductChatId = null;
                // Disable input when closed
                inputElement.disabled = true;
                sendButton.disabled = true;
            }

            /* ===== 4. Event Listeners Initialization ===== */

            // 4.1. Category Filtering
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    currentFilter = button.getAttribute('data-filter');
                    
                    // Update active button state
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    renderProducts(currentFilter, greenTagOnly);
                });
            });

            // 4.2. Green Tag Checkbox Filter
            greenTagFilterCheckbox.addEventListener('change', (e) => {
                greenTagOnly = e.target.checked;
                renderProducts(currentFilter, greenTagOnly);
            });


            // 4.3. Detail Sidebar Handlers
            closeSidebarBtn.addEventListener('click', hideProductDetail);
            
            // 4.4. Tab Switching Logic for Detail Panel
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const target = button.getAttribute('data-tab-content');
                    
                    // Update active button state
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    // Show/hide content
                    tabContents.forEach(content => content.classList.add('hidden'));
                    document.getElementById(`${target}-content`).classList.remove('hidden');

                    // If switching back to story tab, ensure chat state is correct
                    if (target === 'story' && currentProductChatId) {
                        // Re-enable input if it was the user's turn when they left
                        const currentStep = chatHistory[currentProductChatId];
                        const data = mockChatResponses[currentProductChatId];
                        if (data && currentStep < data.length && data[currentStep].role === USER_TURN) {
                             inputElement.disabled = false;
                             sendButton.disabled = false;
                        }
                    } else {
                        // Disable input if on Green Tag tab
                        inputElement.disabled = true;
                        sendButton.disabled = true;
                    }

                });
            });

            // Initial render on page load
            renderProducts(currentFilter, greenTagOnly);

        });
    </script>
</body>
</html>